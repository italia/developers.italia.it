
<script src="{{ '/assets/scripts/jquery.dataTables.min.js' | relative_url }}"></script>

<script src="{{ '/assets/scripts/dataTables.responsive.min.js' | relative_url }}"></script>

<script src="{{ '/assets/scripts/dataTables.uikit.js' | relative_url }}"></script>

<script src="{{ '/assets/scripts/select2.min.js' | relative_url }}"></script>

<script src="{{ '/assets/scripts/bootstrap-italia.min.js' | relative_url }}"></script>

<script src="{{ '/assets/scripts/moment.js' | relative_url }}"></script>

<script src="{{ '/assets/scripts/Chart.min.js' | relative_url }}"></script>

<script src="{{ '/assets/scripts/jquery.mousewheel.min.js' | relative_url }}"></script>

<script src="{{ '/assets/scripts/owl.carousel.min.js' | relative_url }}"></script>

<script src="{{ '/assets/scripts/elasticsearch.min.js' | relative_url }}"></script>
<script src="{{ '/assets/scripts/throbber.js' | relative_url }}"></script>
<script src="{{ '/assets/scripts/handlebars.runtime.js' | relative_url }}"></script>
<script src="{{ '/assets/templates/software.tpl.js' | relative_url }}"></script>
<script src="{{ '/assets/templates/tot.tpl.js' | relative_url }}"></script>
<script src="{{ '/assets/templates/suggestion.tpl.js' | relative_url }}"></script>
<script src="{{ '/assets/templates/pager.tpl.js' | relative_url }}"></script>
<script src="{{ '/assets/scripts/esDevelopersItaliaQuery.js' | relative_url }}"></script>
<script src="{{ '/assets/scripts/esQuery.config.js' | relative_url }}"></script>
<script src="{{ '/assets/scripts/esQuery.js' | relative_url }}"></script>
<script src="{{ '/assets/scripts/perfect-scrollbar.min.js' | relative_url }}"></script>
<script src="{{ '/assets/scripts/photoswipe.min.js' | relative_url }}"></script>
<script src="{{ '/assets/scripts/photoswipe-ui-default.min.js' | relative_url }}"></script>

<script>
  $(document).on('keydown', function(e) {
    if (e.keyCode === 9) {
      $('body').removeClass('hide-focus');
    } else if (e.keyCode == 191) { // slash
      $('#cerca').focus();
      e.preventDefault();
    }
  })

  $(document).on('click', function(e) {
    $('body').addClass('hide-focus');
  })

  $('*[data-activate-element]').on('click',function(e){
    e.preventDefault();
    var genid = $(this).data('activeid');
    var noscroll = $(this).data('activate-noscroll') ? true : false;
    var $targetelement = $('*[data-activatedby="'+genid+'"]');
    $targetelement.toggleClass('deactive');
    $(this).toggleClass('active');
    if (noscroll==true) {
      $('body').toggleClass('stopScrolling--vertical');
    }
  });

  {% if page.vitalityDataChart != nil %}
    var ctx = document.getElementById("vitalityChart").getContext("2d");
    var myLineChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: ['j', 'f', 'm', 'a', 'm', 'j', 'j', 'a', 's', 'o', 'n', 'd'],
        datasets: [{
          fill: false,
          lineTension: 0.1,
          data: {{ page.vitalityDataChart | jsonify }},
          borderWidth: 2,
          borderColor: '#06c'
        }]
      },
      options: {
        scales: {
          xAxes: [{
            display: false,
            stacked: true
          }],
          yAxes: [{
            display: false,
            stacked: true,
            ticks: {
              beginAtZero:true
            }
          }]
        },
        legend: {
          display: false,
        },
        elements: {
          point: {
            radius: 0
          }
        },
        layout: {
          padding: {
            left: 5,
            right: 5,
            top: 5,
            bottom: 5
          }
        }
    });
  {% endif %}

  $(document).ready(function(){
    var owl = $('.owl-carousel');
    owl.owlCarousel({
      margin: 4,
      loop: true,
      responsive:{
        0:{
          items:1
        },
        600:{
          items:3
        },
        960:{
          items:4
        }
      }
    });
    owl.on('mousewheel', '.owl-stage', function(e) {
      if (e.deltaY > 0) {
        owl.trigger('next.owl');
      } else {
        owl.trigger('prev.owl');
      }
      e.preventDefault();
    });
  })

  var ps = new PerfectScrollbar('.tiled-gallery', {
    maxScrollbarLength: 24
  })

  var initPhotoSwipeFromDOM = function(gallerySelector) {
    // parse slide data (url, title, size ...) from DOM elements
    // (children of gallerySelector)
    var parseThumbnailElements = function(el) {
      var linkElements = el.getElementsByTagName('a')
      var items = []

      for (var i = 0; i < linkElements.length; i++) {
        var linkEl = linkElements[i];
        var size = linkEl.dataset.size.split('x');

        // create slide object
        var item = {
          src: linkEl.getAttribute('href'),
          w: Number(size[0]),
          h: Number(size[1]),
          msrc: linkEl.children[0].src,
        };

        item.el = linkEl; // save link to element for getThumbBoundsFn
        items.push(item);
      }

      return items;
    };

    // triggers when user clicks on thumbnail
    var onThumbnailsClick = function(e) {
      e.preventDefault()

      // find root element of slide
      var clickedListItem = e.target.parentNode

      if (clickedListItem.tagName !== 'A') return;

      var clickedGallery = $(clickedListItem).closest('.tiled-gallery-inner')[0]
      var index = Number(clickedListItem.dataset.index)

      if (index >= 0) {
        openPhotoSwipe(index, clickedGallery);
      }
    };

    var openPhotoSwipe = function(index, galleryElement) {
      var pswpElement = document.querySelectorAll('.pswp')[0]
      var gallery
      var options
      var items

      items = parseThumbnailElements(galleryElement);

      options = {
        index: index,
        getThumbBoundsFn: function(index) {
          // See Options -> getThumbBoundsFn section of documentation for more info
          var thumbnail = items[index].el.getElementsByTagName('img')[0] // find thumbnail
          var pageYScroll = window.pageYOffset || document.documentElement.scrollTop
          var rect = thumbnail.getBoundingClientRect()

          return {
            x: rect.left,
            y: rect.top + pageYScroll,
            w: rect.width
          };
        }
      };

      // Pass data to PhotoSwipe and initialize it
      gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, options);
      gallery.init();
    };

    // loop through all gallery elements and bind events
    var galleryElements = document.querySelectorAll(gallerySelector);

    galleryElements.forEach(function(galleryEl, i) {
      galleryEl.setAttribute('data-pswp-uid', i + 1);
      galleryEl.onclick = onThumbnailsClick;
    })
  };

  initPhotoSwipeFromDOM('.tiled-gallery-inner');
</script>
